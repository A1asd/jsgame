<canvas id="ctx" width="500" height="300" style="border: 1px solid black"></canvas>
<p id="motd"></p>
<div>
	<label>Ping zum Server:</label> <label id="ping"></label> <label>ms</label>
</div>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>

// https://stackoverflow.com/questions/28207232/draw-border-around-nontransparent-part-of-image-on-canvas/28220510 fÃ¼r sprites hinter objekten (bosse zB?. sollte geil sein)

	const fs = require('fs');
	fs.readFile('keybinds.json', (err, data) => {
		if (err) throw err;
		let keybinds = JSON.parse(data);
	})

	var socket = io();
	var ctx = document.getElementById('ctx').getContext("2d");

	ctx.font = "30px Arial";

	socket.on('serverMsg', function(data) {
		document.getElementById("motd").innerHTML = data.msg;
	});

	var pingstart = 0;

	setInterval(function() {
		pingServer();
	}, 1000);
	
	function pingServer() {
		socket.emit('pingRequest');
		pingstart = new Date();
	}

	socket.on('pingResponse', function() {
		let pingend = new Date();
		document.getElementById('ping').innerHTML = pingend - pingstart;
	});

	var keystates = {
		moveDown: false,
		moveUp: false,
		moveLeft: false,
		moveRight: false,
	};

	socket.on('newPosition', function(data) {
		ctx.clearRect(0, 0, 500, 300);
		for (var i = 0; i < data.length; i++) {
			ctx.fillText('A', data[i].x, data[i].y);
		}
	});

	document.addEventListener('keydown', function(event) {
		if (event.code === "KeyW") keystates.moveUp = true;
		if (event.code === "KeyS") keystates.moveDown = true;
		if (event.code === "KeyA") keystates.moveLeft = true;
		if (event.code === "KeyD") keystates.moveRight = true;

		socket.emit('keystateUpdate', keystates);
	});

	document.addEventListener('keyup', function(event) {
		if (event.code === "KeyW") keystates.moveUp = false;
		if (event.code === "KeyS") keystates.moveDown = false;
		if (event.code === "KeyA") keystates.moveLeft = false;
		if (event.code === "KeyD") keystates.moveRight = false;

		socket.emit('keystateUpdate', keystates);
	});
	
</script>
